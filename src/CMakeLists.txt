WC3LIB_ENABLE_EXCEPTIONS()

WC3LIB_GET_H(wc3lib_CORE_H)
WC3LIB_GET_SRC(wc3lib_CORE_SRC)

if (EDITOR OR PLUGINS)
	include_directories(${CMAKE_CURRENT_BINARY_DIR}/editor) # include binary dir since the KDE configuration class will be generated there and has to be included (also include for moc cxx files)
endif ()

add_library(wc3libcore ${wc3lib_CREATION_MODE} ${wc3lib_CORE_SRC})
if (NOT STATIC AND UNIX)
	# TODO: dl is required for using dlopen etc. (cross platform?)
	target_link_libraries(wc3libcore dl)
endif ()
target_link_libraries(wc3libcore ${Boost_LIBRARIES})
set_property(TARGET wc3libcore PROPERTY LINK_INTERFACE_LIBRARIES "")

if (BLP)
	add_subdirectory(blp)
endif ()
#add_subdirectory(lang)
if (MDLX)
	add_subdirectory(mdlx)
endif ()
if (MPQ)
	add_subdirectory(mpq)
endif ()
if (MAP)
	add_subdirectory(map)
endif (MAP)

# libraries without editor
set(wc3lib_CORE_LIBRARIES wc3libcore)
if (BLP)
	list(APPEND wc3lib_CORE_LIBRARIES wc3libblp)
endif ()
if (MDLX)
	list(APPEND wc3lib_CORE_LIBRARIES wc3libmdlx)
endif ()
if (MPQ)
	list(APPEND wc3lib_CORE_LIBRARIES wc3libmpq)
endif ()
if (MAP)
	list(APPEND wc3lib_CORE_LIBRARIES wc3libmap)
endif ()
# wc3liblang

if (EDITOR OR PLUGINS)
	add_subdirectory(editor) # last one
endif ()

# all available libraries
set(wc3lib_LIBRARIES ${wc3lib_CORE_LIBRARIES})
set(wc3lib_SRC ${wc3lib_CORE_SRC})
if (BLP)
	set(wc3lib_SRC ${wc3lib_SRC} ${wc3lib_BLP_SRC})
endif ()
if (MDLX)
	set(wc3lib_SRC ${wc3lib_SRC} ${wc3lib_MDLX_SRC})
endif ()
if (MPQ)
	set(wc3lib_SRC ${wc3lib_SRC} ${wc3lib_MPQ_SRC})
endif ()
if (MAP)
	set(wc3lib_SRC ${wc3lib_SRC} ${wc3lib_MAP_SRC})
endif ()
# ${wc3lib_LANG_SRC}
if (EDITOR)
	set(wc3lib_LIBRARIES ${wc3lib_LIBRARIES} wc3libeditor)
	set(wc3lib_SRC ${wc3lib_SRC} ${wc3lib_EDITOR_SRC})
endif ()

#add_library(wc3lib SHARED ${wc3lib_SRC})
#if (NOT FLAG_STATIC_USE)
	# TODO: dl is required for using dlopen etc. (cross platform?)
#	target_link_libraries(wc3lib dl)
#endif ()
#target_link_libraries(wc3lib ${GETTEXT_LIBRARIES} ${Boost_LIBRARIES})
#if (FLAG_EDITOR_USE)
#	target_link_libraries(wc3lib ${OGRE_LIBRARIES} ${QT_LIBRARIES} ${KDE4_KIO_LIBS} ${KDE4_KUTILS_LIBS} ${KDE4_KPARTS_LIBS})
#endif ()

if (APP)
	add_subdirectory(app)
endif ()

# install
install(TARGETS wc3libcore DESTINATION lib/wc3lib)
#install(TARGETS wc3lib DESTINATION lib/wc3lib)
install(FILES ${wc3lib_CORE_H} DESTINATION include/wc3lib)