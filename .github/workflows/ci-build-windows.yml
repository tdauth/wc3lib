name: Windows CMake Ninja Clang Build

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master
  schedule:
    # Run the build every day at 4:00 AM UTC
    - cron: '0 4 * * *'

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Configure CMake with Clang (NMake Generator)
      # We still set the compiler variables to ensure Clang is used, 
      # but the generator is NMake Makefiles
      run: cmake -B build -G "Ninja" -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++
      env:
        CC: clang
        CXX: clang++

    - name: Build project
      # Use the --build command to run NMake
      run: cmake --build build --config Release

    - name: Run tests (optional)
      run: cmake --test build
      
    - name: Run CPack to generate installer
      # No special Visual Studio environment setup (vcvarsall.bat) is needed for the Ninja build.
      # CPack uses the build system metadata to create the package.
      run: cmake --build build --target package --config Release

    - name: Upload installer artifact
      uses: actions/upload-artifact@v4
      with:
        name: wc3lib-Installer
        path: build/*.exe # Adjust path/extension based on your CPack generator
